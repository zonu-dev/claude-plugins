---
description: GitHub PRのコードレビューを行う。PRの差分を分析し、コード品質・セキュリティ・パフォーマンス・ベストプラクティスの観点から構造化されたレビューを提供し、ユーザーの指示に応じてコード修正を行う。
argument-hint: "[PR番号またはURL]"
disable-model-invocation: true
---

# PRレビュー

GitHub PRの差分を分析し、構造化されたコードレビューを提供する。

## レビューワークフロー

### ステップ1: PR情報の取得

引数からPR番号を特定する：
- 数値: PR番号として使用
- URL: PR番号を抽出
- 引数なし: AskUserQuestionツールでPR番号を質問

PR情報を取得する：
```bash
gh pr view <PR番号> --json title,body,author,baseRefName,headRefName,files,additions,deletions,changedFiles
```

取得失敗時はエラーメッセージを表示して終了。

### ステップ2: 変更内容の把握

変更ファイル一覧と差分を取得する：
```bash
gh pr diff <PR番号>
```

CI/CDステータスを確認する：
```bash
gh pr checks <PR番号>
```

変更規模に応じて分析方針を決定：
- **小規模**（~10ファイル、~300行）: 全差分を直接分析
- **中規模**（~30ファイル、~1000行）: ファイル種別ごとにグループ化して分析
- **大規模**（30ファイル超、1000行超）: 重要ファイル（ロジック変更、API変更、セキュリティ関連）を優先分析

差分が大きい場合、Readツールで変更ファイルの全体を読み、変更の文脈を理解する。

### ステップ3: コードレビュー

[review-checklist.md](references/review-checklist.md) に基づいて以下の観点でレビューする：

1. **コード品質**: 可読性、保守性、命名、重複、複雑度
2. **正確性**: ロジックエラー、エッジケース、エラーハンドリング
3. **セキュリティ**: インジェクション、XSS、認証・認可、シークレット漏洩
4. **パフォーマンス**: N+1クエリ、不要なループ、メモリリーク
5. **テスト**: テストカバレッジ、テストケースの妥当性
6. **設計**: SOLID原則、関心の分離、既存アーキテクチャとの整合性

### ステップ4: レビューレポート生成

以下の形式で出力する：

```markdown
# PRレビュー: <PRタイトル> (#<PR番号>)

## 概要
- 変更規模: <ファイル数>ファイル (+<追加行> -<削除行>)
- 主な変更内容: <1-2文の要約>

## 指摘事項

### Critical（マージ前に修正必須）
<セキュリティ脆弱性、データ損失リスク、重大なロジックエラー>

### Important（修正を強く推奨）
<バグの可能性、パフォーマンス問題、テスト不足>

### Suggestion（改善提案）
<リファクタリング、可読性向上、ベストプラクティス>

### Positive（良い点）
<良い設計判断、適切なテスト、きれいなコード>

## 総合評価
<マージ可否の所感と、優先的に対応すべき指摘事項のまとめ>
```

指摘には必ずファイルパスと行番号を含める（例: `src/api/handler.ts:42`）。

### ステップ5: 修正対応

レビューレポート提示後、AskUserQuestionツールで指摘事項のうちどこまで対応するかをユーザーに確認する。

ユーザーの回答に応じてコードの修正を進める。修正完了後、変更内容のサマリーを提示する。

## 注意事項

- レビューコメントは建設的で具体的に記述する
- 問題の指摘だけでなく、改善案も必ず提示する
- プロジェクトのCLAUDE.mdやルールファイルが存在する場合、プロジェクト固有の規約も考慮する
- 大規模なPRは重要な変更に集中し、フォーマットのみの変更は軽く扱う
