---
name: review-instructions
description: CLAUDE.mdファイルをベストプラクティスに基づいてレビューする。コンテンツ品質、構造、サイズ、ルールファイルとの整合性を評価し改善提案を行う。「CLAUDE.mdをレビューして」「CLAUDE.mdを検証」「CLAUDE.mdの品質チェック」などのリクエストで起動する。
argument-hint: "[CLAUDE.mdファイルパス]"
---

# CLAUDE.mdレビュー

公式ドキュメントとコミュニティのベストプラクティスに基づいてCLAUDE.mdファイルをレビューし、具体的な改善提案を行う。

## レビューワークフロー

### ステップ1: 対象ファイルの特定

レビュー対象のCLAUDE.mdファイルを特定する：
- ユーザーがパスを直接指定 → そのファイルをレビュー
- 指定なし → カレントディレクトリの `CLAUDE.md` を検索
- 見つからなければ `.claude/CLAUDE.md` を検索
- `CLAUDE.local.md` が存在する場合はそれも対象に含めるか確認

### ステップ2: コンテキスト収集

1. 対象のCLAUDE.mdファイルを完全に読み込む
2. [best-practices.md](references/best-practices.md) でチェックリストを確認
3. ファイル種別を判定（プロジェクト共有 / プロジェクトローカル）
4. `.claude/rules/` が存在する場合、全ルールファイルを読み込む（重複・矛盾チェック用）
5. プロジェクトの実態を簡易調査する：
   - `package.json`, `Cargo.toml`, `go.mod`, `pyproject.toml` 等の存在確認
   - 主要ディレクトリ構成の把握
   - CLAUDE.mdに記載されたコマンドの存在を `which` や `command -v` で確認する（コマンドの実行はしない）

### ステップ3: ベストプラクティスとの照合

各カテゴリを評価：

**構造チェック**
- 推奨セクション（Project Overview, Commands, Code Style, Architecture, File Structure, Testing, Git Workflow）の充足度
- セクションが重要度順に配置されているか
- マークダウン見出しで適切に構造化されているか

**コンテンツ品質チェック**
- 含めるべき内容（推測困難なコマンド、プロジェクト固有の規約等）が含まれているか
- 含めるべきでない内容（自明な情報、標準的な言語規約、ユーザー向けドキュメント等）が含まれていないか
- 各セクションが「この行を削除するとClaudeが間違えるか？」のリトマステストに合格するか
- 各ルールが具体的でアクショナブルか
- コード例がある場合、適切な長さ（5〜20行）で実用的か
- 環境変数にシークレットの実値が含まれていないか

**サイズチェック**
- 行数が適切か（推奨: 30〜100行、上限目安: 200行、400行超は要削減）

**ルールファイルとの整合性チェック**（`.claude/rules/` が存在する場合）
- CLAUDE.mdとルールファイルの間に内容重複がないか
- CLAUDE.mdとルールファイルの間に矛盾がないか
- CLAUDE.mdが簡潔なルーティング役に留まっているか（詳細はルールに分離すべき）

**@importチェック**（`@path/to/file` 形式のインポートがある場合）
- 参照先ファイルが存在するか
- インポート深度が5ホップ以内か

**プロジェクト実態との整合性チェック**
- 記載されたコマンドがプロジェクトの実態と一致しているか
- 記載されたファイル構造が実際の構成と一致しているか
- 記載された技術スタックが実際の依存関係と一致しているか

**アンチパターン検出**
- 肥大化（400行超）
- 自明な情報の記載
- 陳腐化する時間依存情報
- コードの大量埋め込み
- シークレットの埋め込み
- 絶対パスのハードコード
- リンターで代替可能なルール
- 曖昧で非アクショナブルな指示
- ユーザー向けドキュメント（セットアップ手順、インストール方法等、READMEに書くべき内容）

### ステップ4: レビューレポート生成

出力形式：

```markdown
# CLAUDE.mdレビューレポート

## サマリー
- ファイル: {パス}
- 種別: {プロジェクト共有 | プロジェクトローカル}
- 行数: {行数}
- 総合評価: {PASS | NEEDS_IMPROVEMENT | CRITICAL_ISSUES}
- Critical: {件数} / Warning: {件数} / Info: {件数}

## Critical（必須修正）
{修正必須の問題をリスト}

## Warning（推奨修正）
{推奨される改善をリスト}

## Info（改善提案）
{オプションの強化をリスト}

## セクション充足度
{推奨セクションの有無を表形式で提示}

## 具体的な推奨事項
{例を含む具体的なアクションアイテム}
```

### ステップ5: インタラクティブな改善

レポート提示後：
1. ユーザーに修正を希望するか確認
2. Critical問題を優先的に修正
3. 段階的に修正を適用
4. 各修正後に再検証

## 重大度分類

### Critical
CLAUDE.mdの正常な機能を妨げる問題：
- ファイルが空または実質的に内容がない
- シークレット（APIキー、パスワード、トークン）が含まれている
- `.claude/rules/` との明確な矛盾がある
- `@import` のリンク先が存在しない

### Warning
CLAUDE.mdの効果を低下させる問題：
- 400行を超えている
- `.claude/rules/` との内容重複がある
- 推測困難なコマンドが記載されていない
- 技術スタックの記述がない（プロジェクトレベル）
- 自明な情報・標準的な言語規約が含まれている
- 曖昧で非アクショナブルな指示がある
- 陳腐化しやすい時間依存情報がある
- 絶対パスがハードコードされている
- リンターで代替可能なルールが記載されている
- 記載内容とプロジェクト実態が不一致

### Info
改善の機会：
- より簡潔にできる箇所
- セクション構成の最適化
- コード例の追加
- ルールファイルへの分離で改善できる箇所
- 強調表現の活用（重要なルールに IMPORTANT 等を付与）
- BAD/GOOD対比例の追加

## レビューセッション例

ユーザー: 「CLAUDE.mdをレビューして」

```
1. CLAUDE.md を読み込み
2. .claude/rules/ を読み込み（重複チェック用）
3. プロジェクト実態を簡易調査
4. best-practices.md に照らして分析
5. 日本語でレポート生成
6. 修正を提案
```

**レポート出力例**:
```markdown
# CLAUDE.mdレビューレポート

## サマリー
- ファイル: ./CLAUDE.md
- 種別: プロジェクト共有
- 行数: 45行
- 総合評価: NEEDS_IMPROVEMENT
- Critical: 0 / Warning: 2 / Info: 2

## Warning（推奨修正）
1. テストコマンドが記載されていない → `npm test` や単一テスト実行方法を追加すべき
2. `.claude/rules/testing.md` に記載されたテスト規約がCLAUDE.mdにも重複して記載されている → CLAUDE.mdからは削除しルールに委譲

## Info（改善提案）
1. File Structureセクションの追加を推奨（モノレポ構成のため特に有効）
2. 「適切にエラーハンドリングする」→ 具体的なパターンに書き換え推奨

## セクション充足度
| セクション | 状態 |
|-----------|------|
| Project Overview | あり |
| Commands | 一部欠落（テストコマンドなし） |
| Code Style | あり |
| Architecture | あり |
| File Structure | なし（追加推奨） |
| Testing | なし（追加推奨） |
| Git Workflow | あり |

## 具体的な推奨事項
- Commandsセクションにテスト関連コマンドを追加:
  \`\`\`bash
  # テスト
  npm test                    # 全テスト実行
  npm test -- path/to/test    # 単一テスト実行
  \`\`\`
- `.claude/rules/testing.md` と重複する「TDD: テストを先に書く」「カバレッジ80%以上」の記述を削除
```

**CRITICAL_ISSUESの出力例**:
```markdown
# CLAUDE.mdレビューレポート

## サマリー
- ファイル: ./CLAUDE.md
- 種別: プロジェクト共有
- 行数: 520行
- 総合評価: CRITICAL_ISSUES
- Critical: 1 / Warning: 3 / Info: 1

## Critical（必須修正）
1. 12行目に `STRIPE_SECRET_KEY=sk_live_xxx...` がハードコードされている → 即座に削除し、gitの履歴からも除去すべき。キーのローテーションも必要

## Warning（推奨修正）
1. 520行と大幅に肥大化 → 重要なルールが埋もれて無視される。200行以下に削減すべき
2. 「きれいなコードを書く」「パフォーマンスに注意する」等の曖昧な指示が多数 → 具体的な基準に書き換え
3. ESLintで検出可能なインデントルールが記載されている → リンターに委譲

## Info（改善提案）
1. Database, Authentication, Billingの詳細ルールを `.claude/rules/` に分離推奨

## 具体的な推奨事項
- **最優先**: 12行目のシークレットを削除。`git filter-branch` または `git-filter-repo` で履歴からも除去
- 以下のセクションを `.claude/rules/` に分離:
  - Database rules → `.claude/rules/database.md`
  - Auth rules → `.claude/rules/authentication.md`
  - Billing rules → `.claude/rules/billing.md`
- CLAUDE.mdは概要とコマンドに集中させ、200行以下に削減
```
