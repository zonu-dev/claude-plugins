# Rule Best Practices Checklist

## 目次

1. [Frontmatter (YAML)](#1-frontmatter-yaml)
2. [ファイル構成](#2-ファイル構成)
3. [コンテンツ品質](#3-コンテンツ品質)
4. [CLAUDE.md との関係](#4-claudemd-との関係)
5. [アンチパターン](#5-アンチパターン)
6. [実効性の検証](#6-実効性の検証)

## 1. Frontmatter (YAML)

### スコープ指定

- [ ] パス固有ルールには `paths` フロントマターがある
- [ ] `paths` の各パターンが有効なグロブである
- [ ] `paths` に指定したパターンが実際のファイルにマッチする
- [ ] 常時適用ルールにはフロントマターがない（または空）

### パターン品質

- [ ] パターンが広すぎない（`**/*` のような全マッチを避ける）
- [ ] パターンが狭すぎない（1ファイルだけにマッチするパターンを避ける）
- [ ] 複数の関連パスをまとめている（例: routes と services の両方を含む）
- [ ] フォワードスラッシュを使用している（バックスラッシュはNG）

### スコープ判断基準

| ルールの性質 | 推奨スコープ |
|---|---|
| パッケージ間の依存方向 | 常時適用（フロントマターなし） |
| コーディング規約全般 | 常時適用（フロントマターなし） |
| 特定パッケージの設計制約 | `paths` 指定 |
| 特定レイヤーのルール | `paths` 指定 |
| 特定ファイル形式の扱い | `paths` 指定 |

## 2. ファイル構成

### 1ファイル1関心事

- [ ] 1つのルールファイルが1つのドメイン/関心事に集中している
- [ ] 複数の無関係なルールが1ファイルに混在していない
- [ ] ファイルを分割すべき兆候がない:
  - 見出しが3つ以上の無関係なトピックを扱っている
  - `paths` パターンが無関係な複数ディレクトリを指している
  - ファイルが長すぎる（100行超）

### ファイル命名

- [ ] ファイル名がルールの内容を端的に表している
- [ ] ケバブケースを使用している（`api-layers.md`, `billing.md`）
- [ ] 汎用的すぎる名前を避けている（`rules.md`, `misc.md`, `notes.md` はNG）
- [ ] ドメイン名を含んでいる（`billing.md`, `srs.md`, `notifications.md`）

### ディレクトリ構成

- [ ] 小規模（〜10ファイル）はフラット構成で十分
- [ ] 大規模はサブディレクトリで整理（`frontend/`, `backend/`, `shared/`）
- [ ] サブディレクトリは2階層以上ネストしていない

## 3. コンテンツ品質

### アクショナブルであること

- [ ] 各指示が具体的で実行可能である
- [ ] 「〜に注意する」「〜を意識する」のような曖昧な表現を避けている
- [ ] 「〜してはならない」「〜を使う」「〜の順で呼び出す」のような明確な指示である
- [ ] 判断基準が明確に示されている（「大きいファイル」ではなく「800行を超えるファイル」）

**良い例**:
```markdown
- routes/ から repositories/ を直接呼び出してはならない。必ず services/ を経由する
- API レスポンスは `{ success, data?, error? }` 形式に統一する
```

**悪い例**:
```markdown
- コードの品質に注意する
- パフォーマンスを意識して実装する
```

### 簡潔さ

- [ ] 100行以下である（目安）
- [ ] 冗長な説明がない
- [ ] コードの自明な部分を再説明していない
- [ ] 箇条書きやチェックリストで簡潔に表現している

### チェックリスト形式の活用

- [ ] 検証可能なルールはチェックリスト形式にしている
- [ ] チェック項目が Yes/No で判定できる

## 4. CLAUDE.md との関係

### 役割分担

| 内容 | 置き場 |
|---|---|
| プロジェクト概要・技術スタック | `CLAUDE.md` |
| 主要コマンド一覧 | `CLAUDE.md` |
| コミットメッセージ規約 | `CLAUDE.md` |
| パッケージ間の依存方向 | `.claude/rules/`（常時適用） |
| 特定ドメインの設計制約 | `.claude/rules/`（パス指定） |
| レイヤー間の呼び出し規則 | `.claude/rules/`（パス指定） |

### 重複・矛盾チェック

- [ ] `CLAUDE.md` に同じ内容が書かれていない
- [ ] `CLAUDE.md` の記述と矛盾していない
- [ ] 他のルールファイルと内容が重複していない
- [ ] `CLAUDE.md` が簡潔なルーティング役に留まっている（詳細はルールに分離）

## 5. アンチパターン

### 避けるべきこと

- [ ] **陳腐化するコード例**: ソースコードの断片を埋め込んでいない（リンクで参照すべき）
- [ ] **曖昧な指示**: 「適切に」「必要に応じて」のような判断丸投げ表現がない
- [ ] **過剰な制約**: 開発の柔軟性を不必要に制限していない
- [ ] **存在しないパス**: `paths` に指定したパスが実際に存在する
- [ ] **全マッチパターン**: `**/*` のような実質的に全ファイルマッチするパターンがない
- [ ] **重複ルール**: 複数ファイルに同じルールが書かれていない
- [ ] **自明なルール**: わざわざ記載しなくても常識で判断できるルールがない
- [ ] **時間依存情報**: 日付や「現在は」のような陳腐化する表現がない

## 6. 実効性の検証

### パスマッチの検証

対象リポジトリで `paths` パターンが有効かを確認する方法：
- Glob ツールでパターンにマッチするファイルが存在するか確認
- マッチするファイルがゼロ件なら Critical

### 矛盾の検証

- 複数ルール間で相反する指示がないか
- `CLAUDE.md` の記述と矛盾がないか

## Severity Levels

### Critical (必須修正)

- `paths` パターンにマッチするファイルが存在しない
- `CLAUDE.md` と矛盾する指示がある
- ルールファイルが空または実質的に内容がない
- フロントマターの構文エラー

### Warning (推奨修正)

- `CLAUDE.md` との内容重複
- スコープが広すぎる（常時適用にすべき）またはスコープが狭すぎる
- 曖昧で非アクショナブルな指示
- 1ファイルに複数の関心事が混在
- ファイル名と内容の不一致
- 他ルールとの内容重複

### Info (改善提案)

- より簡潔にできる箇所
- チェックリスト形式への変換で改善する箇所
- ファイル分割や統合の提案
- カバーされていないドメインの追加提案
