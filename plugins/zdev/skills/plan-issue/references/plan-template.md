# 計画テンプレート

## 計画の形式

```markdown
## 実装計画: #<number> <title>

### 決定事項

| 項目 | 選択 | 理由 | 備考 |
|------|------|------|------|
| 認証方式 | JWT | スケーラビリティ重視 | リフレッシュトークン実装 |

### 要件サマリ
- 主要目標: ...
- 技術的制約: ...

### 受け入れ基準
- [ ] ...
- [ ] ...

### 影響範囲

| ファイル | 役割 | 変更種別 |
|---------|------|---------|
| path/to/file | ... | 新規/修正 |

### 実装ステップ

1. **Step 1: タイトル**
   - 詳細説明
   - 関連ファイル: `path/to/file`

2. **Step 2: タイトル**
   - 詳細説明

### リスク・考慮事項
- ...

### 次のステップ
1. `/zdev:implement-issue <number>` で開発を開始
```

## 出力例

```markdown
## 実装計画: #42 Add user authentication

### 決定事項

| 項目 | 選択 | 理由 | 備考 |
|------|------|------|------|
| 認証方式 | JWT | スケーラビリティ重視 | リフレッシュトークン実装 |
| パスワード保存 | bcrypt | 業界標準、十分なセキュリティ | コスト12 |
| トークン有効期限 | 1時間 | セキュリティとUXのバランス | リフレッシュで延長 |

### 要件サマリ
- 主要目標: JWTを使用したユーザー認証機能の追加
- 技術的制約: 既存のExpress.jsミドルウェアパターンに従う

### 受け入れ基準
- [ ] ログイン/ログアウトAPIが動作する
- [ ] JWTトークンが正しく発行・検証される
- [ ] 認証が必要なエンドポイントが保護される
- [ ] リフレッシュトークンで期限延長できる

### 影響範囲

| ファイル | 役割 | 変更種別 |
|---------|------|---------|
| src/middleware/auth.ts | 認証ミドルウェア | 新規 |
| src/routes/auth.ts | 認証ルート | 新規 |
| src/routes/index.ts | ルート登録 | 修正 |
| src/types/user.ts | ユーザー型定義 | 修正 |
| src/utils/jwt.ts | JWTユーティリティ | 新規 |

### 実装ステップ

1. **Step 1: JWTユーティリティの作成**
   - トークン生成・検証関数を実装
   - 関連ファイル: `src/utils/jwt.ts`

2. **Step 2: 認証ミドルウェアの実装**
   - リクエストからトークンを抽出・検証
   - 関連ファイル: `src/middleware/auth.ts`

3. **Step 3: 認証APIの実装**
   - POST /auth/login, POST /auth/logout, POST /auth/refresh
   - 関連ファイル: `src/routes/auth.ts`

4. **Step 4: テストの追加**
   - 単体テスト、統合テスト
   - 関連ファイル: `src/__tests__/auth.test.ts`

### リスク・考慮事項
- パスワードは必ずハッシュ化して保存
- トークンの有効期限を適切に設定
- HTTPS必須（本番環境）

### 次のステップ
1. `/zdev:implement-issue 42` で開発を開始
2. JWTユーティリティから実装

---
Issue #42 に計画を反映しました。
```
