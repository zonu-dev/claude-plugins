# Agent Best Practices Checklist

## 目次

1. [Frontmatter (YAML)](#1-frontmatter-yaml)
2. [システムプロンプト（ボディ）](#2-システムプロンプトボディ)
3. [ツールスコープ](#3-ツールスコープ)
4. [モデル選定](#4-モデル選定)
5. [ワークフロー設計](#5-ワークフロー設計)
6. [出力形式](#6-出力形式)
7. [品質と例](#7-品質と例)
8. [アンチパターン](#8-アンチパターン)

## 1. Frontmatter (YAML)

### name
- [ ] 小文字、数字、ハイフンのみ使用している
- [ ] タスクの性質を端的に表す名前である（例: `issue-analyzer`, `test-runner`, `code-reviewer`）
- [ ] 曖昧な名前を避けている（`helper`, `agent`, `worker` はNG）

### description
- [ ] 空でない
- [ ] エージェントが**何をするか**を1文で説明している
- [ ] Task toolの `subagent_type` 選択時に表示されるため、簡潔で分かりやすい

### tools
- [ ] 必要最小限のツールのみ指定している
- [ ] 読み取り専用エージェントに書き込みツール（Edit, Write, Bash）を含めていない
- [ ] カンマ区切りで列挙している（例: `Glob, Grep, Read`）

### model
- [ ] 明示的に指定している（未指定は親のモデルを継承し、コスト増の原因になる）
- [ ] 用途に対して適切なモデルを選んでいる（後述のモデル選定を参照）

### オプションフィールド
- [ ] `permissionMode`: セキュリティ要件に応じて設定（`bypassPermissions` は慎重に）
- [ ] `maxTurns`: 無限ループ防止のため設定を推奨（デフォルト: なし）
- [ ] `allowedCommands`: Bashツール使用時、許可するコマンドを制限

## 2. システムプロンプト（ボディ）

### 役割定義
- [ ] エージェントの役割・目的が冒頭で明確に定義されている
- [ ] 日本語で記述されている
- [ ] 1つの明確な責任に集中している（Single Responsibility）

### 構造
- [ ] マークダウン見出しで適切にセクション分けされている
- [ ] 「入力」「タスク」「出力」のセクションが明確に分かれている
- [ ] 簡潔である（目安: 200行以下、長くても300行以下）

### 簡潔さ
- [ ] Claudeが既に知っている情報を含まない
- [ ] 冗長な説明より簡潔な指示を優先している
- [ ] 各情報がトークンコストに見合う価値がある

## 3. ツールスコープ

### エージェント種別ごとの推奨ツール

| エージェント種別 | 推奨ツール | 説明 |
|---|---|---|
| 分析・調査系 | `Glob, Grep, Read` | コードベースの読み取りのみ |
| 実装・修正系 | `Glob, Grep, Read, Edit, Write, Bash` | ファイルの読み書き + コマンド実行 |
| レビュー系 | `Glob, Grep, Read` | 読み取り + 分析結果の出力 |
| ドキュメント生成系 | `Glob, Grep, Read, Edit, Write` | 読み取り + ドキュメント書き込み |
| テスト実行系 | `Glob, Grep, Read, Bash` | 読み取り + テストコマンド実行 |

### チェック項目
- [ ] ツールがエージェントの目的に合致している
- [ ] 不要なツールを含めていない（最小権限の原則）
- [ ] 必要なツールが不足していない
- [ ] `Bash` を含む場合、`allowedCommands` での制限を検討している
- [ ] `Task` ツールは特別な理由がない限り含めない（サブエージェントの連鎖を避ける）

## 4. モデル選定

### 用途別推奨モデル

| 用途 | 推奨モデル | 理由 |
|---|---|---|
| 汎用的なタスク | `sonnet` | バランスが良い（推奨デフォルト） |
| 単純な分類・抽出 | `haiku` | 高速・低コスト |
| 定型的なフォーマット変換 | `haiku` | 高速・低コスト |
| 高度な推論・判断 | `opus` | 最高性能だが高コスト |
| 複雑なコード生成 | `sonnet` or `opus` | 品質重視 |
| 大量のファイル処理 | `haiku` | コスト効率 |

### チェック項目
- [ ] 明示的にモデルを指定している
- [ ] 単純タスクに `opus` を指定していない（コスト過剰）
- [ ] 複雑な推論タスクに `haiku` を指定していない（品質不足）
- [ ] デフォルトとして `sonnet` を選択し、理由がある場合のみ変更している

## 5. ワークフロー設計

### 入力仕様
- [ ] エージェントに渡される入力（プロンプト）の形式が明示されている
- [ ] 必須パラメータとオプションパラメータが区別されている
- [ ] 入力例が記載されている

### 処理フロー
- [ ] 処理が明確なステップに分解されている
- [ ] 各ステップの目的が明確である
- [ ] 条件分岐がある場合、分岐条件が明示されている
- [ ] ステップ間の依存関係が明確である

### 出力仕様
- [ ] 出力形式がテンプレートで定義されている
- [ ] 出力の各フィールドの意味が明確である
- [ ] 出力例が含まれている

## 6. 出力形式

### テンプレート
- [ ] マークダウン形式で出力テンプレートが定義されている
- [ ] テンプレート内のプレースホルダが `{変数名}` 形式で統一されている
- [ ] 必須フィールドとオプションフィールドが区別されている

### 例
- [ ] 正常系の出力例が少なくとも1つある
- [ ] 出力例が実際のユースケースに基づいている
- [ ] テンプレートと出力例が整合している

## 7. 品質と例

### Worked Examples
- [ ] 入力から出力までの具体的な流れを示す例がある
- [ ] 基本的なケースの例がある
- [ ] エッジケースや複雑なケースの例がある（該当する場合）

### 信頼度フィルタリング
- [ ] 確信度が低い情報の扱いが定義されている（該当する場合）
- [ ] 「不明」「該当なし」の場合の出力が定義されている

### レッドフラグ
- [ ] セキュリティに関する注意事項が記載されている（該当する場合）
- [ ] 大規模変更時の警告が定義されている（該当する場合）

## 8. アンチパターン

### 避けるべきこと
- [ ] **過剰なツール付与**: 目的に不要なツールを含めていない
- [ ] **モデルの過剰指定**: 単純タスクに高コストモデルを使っていない
- [ ] **曖昧な役割定義**: 「何でもやるエージェント」になっていない
- [ ] **入出力仕様の欠如**: 何を受け取り何を返すか不明確になっていない
- [ ] **過度に長いプロンプト**: 300行を超えるシステムプロンプトになっていない
- [ ] **サブエージェントの連鎖**: Taskツールで別のエージェントを呼ぶ設計になっていない
- [ ] **ハードコードされたパス**: プロジェクト固有のパスが埋め込まれていない
- [ ] **ツールの重複指定**: 同じツールが複数回列挙されていない
- [ ] **英語のシステムプロンプト**: ボディが英語で書かれていない（日本語プロジェクトの場合）
- [ ] **permissionMode: bypassPermissions の安易な使用**: セキュリティリスクを理解せずに設定していない

## Severity Levels

### Critical (必須修正)
- システムプロンプト（ボディ）が空
- descriptionが空
- toolsが目的と大きく乖離（読み取り専用なのにBash付与等）
- フロントマターの構文エラー
- 過剰なツール付与でセキュリティリスクがある

### Warning (推奨修正)
- システムプロンプトが英語で書かれている（日本語プロジェクト）
- modelが未指定
- 入力仕様または出力形式が未定義
- 具体例がない
- 役割定義が曖昧
- ツールの過不足

### Info (改善提案)
- より簡潔にできる箇所
- maxTurnsの設定追加
- 出力テンプレートの改善
- エラーハンドリングの追加
- 条件分岐の明示化
