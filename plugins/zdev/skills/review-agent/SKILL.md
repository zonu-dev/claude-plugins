---
name: review-agent
description: Claude Codeエージェント定義ファイル（.md）をベストプラクティスに基づいてレビューする。フロントマター検証、システムプロンプト品質、ツールスコープ、モデル選定の評価、改善提案を行う。「エージェントをレビューして」「agentを検証」「エージェントの品質チェック」などのリクエストで起動する。
---

# エージェントレビュー

公式ベストプラクティスに基づいてエージェント定義ファイル（`.md`）をレビューし、具体的な改善提案を行う。

## レビューワークフロー

### ステップ1: 対象エージェントの特定

レビュー対象のエージェント定義ファイルを特定する：
- ユーザーがパスを直接指定
- `agents/` ディレクトリ配下の `.md` ファイルを検索
- 複数のエージェントが存在する場合はファイル名を列挙してユーザーに確認

### ステップ2: 読み込みと分析

1. 対象のエージェント定義ファイルを完全に読み込む
2. [best-practices.md](references/best-practices.md) でチェックリストを確認
3. YAMLフロントマター（name, description, tools, model 等）を解析
4. ボディコンテンツ（システムプロンプト）の構造を分析

### ステップ3: ベストプラクティスとの照合

各カテゴリを評価：

**フロントマターチェック**
- name: 命名規則、長さ、形式
- description: 完全性、具体性、英語であること（エージェントは英語description）
- tools: 最小権限の原則に従っているか、用途に対して過不足がないか
- model: 用途に対して適切なモデルが選択されているか（sonnet/haiku/opus）
- オプションフィールド: permissionMode, maxTurns, allowedCommands

**システムプロンプト品質チェック**
- 役割定義が明確か
- 日本語で記述されているか
- ワークフローが具体的なステップに分解されているか
- 入力仕様（何が渡されるか）が明示されているか
- 出力形式がテンプレートで定義されているか
- 具体例（Worked Examples）が含まれているか

**ツールスコープチェック**
- 最小権限の原則に従っているか
- エージェントの目的に対してツールが過剰でないか
- 必要なツールが不足していないか
- 読み取り専用エージェントに書き込みツールが含まれていないか

**モデル選定チェック**
- 用途に対して適切なモデルが選ばれているか
  - sonnet: 汎用的なタスク（推奨デフォルト）
  - haiku: 単純な分類・抽出・定型処理
  - opus: 高度な推論・複雑な判断が必要なタスク
- コストと性能のバランスが取れているか

**ワークフロー明確性チェック**
- 入力・処理・出力の仕様が明確か
- 条件分岐が明示されているか
- エラー時の振る舞いが定義されているか

**言語チェック**
- エージェントのシステムプロンプト（ボディ）が日本語であるか
- 見出し・説明が日本語であるか

**アンチパターン検出**
- 過剰なツール付与（全ツール許可等）
- モデルの過剰指定（単純タスクにopus）
- 曖昧な役割定義
- 入出力仕様の欠如
- 過度に長いシステムプロンプト

### ステップ4: レビューレポート生成

出力形式：

```markdown
# エージェントレビューレポート: {agent-name}

## サマリー
- 総合評価: {PASS | NEEDS_IMPROVEMENT | CRITICAL_ISSUES}
- Critical: {件数}
- Warning: {件数}
- Info: {件数}

## Critical（必須修正）
{修正必須の問題をリスト}

## Warning（推奨修正）
{推奨される改善をリスト}

## Info（改善提案）
{オプションの強化をリスト}

## 具体的な推奨事項
{例を含む具体的なアクションアイテム}
```

### ステップ5: インタラクティブな改善

レポート提示後：
1. ユーザーに修正を希望するか確認
2. Critical問題を優先的に修正
3. 段階的に修正を適用
4. 各修正後に再検証

## 重大度分類

### Critical
エージェントの正常な機能を妨げる問題：
- システムプロンプト（ボディ）が空または実質的に内容がない
- descriptionが空
- toolsが未指定（ボディで何らかのツール操作を前提としている場合）
- フロントマターの構文エラー（YAMLとして解析できない）
- 読み取り専用エージェントに破壊的ツール（Edit, Write, Bash）が含まれている

### Warning
エージェントの効果を低下させる問題：
- システムプロンプトが英語で書かれている
- 役割定義が曖昧
- 入力仕様または出力形式が未定義
- ツールが過剰（目的に対して不要なツールが含まれている）
- モデルが用途に対して不適切（単純タスクにopus等）
- ワークフローが不明確
- 具体例がない

### Info
改善の機会：
- より簡潔にできる箇所
- 出力テンプレートの追加
- 条件分岐の明示化
- エラーハンドリングの追加

## レビューセッション例

ユーザー: 「issue-analyzerエージェントをレビューして」

```
1. 読み込み: agents/issue-analyzer.md
2. ロード: references/best-practices.md
3. チェックリストに照らして分析
4. 日本語でレポート生成
5. 修正を提案
```

**レポート出力例**:
```markdown
# エージェントレビューレポート: issue-analyzer

## サマリー
- 総合評価: NEEDS_IMPROVEMENT
- Critical: 0件
- Warning: 2件
- Info: 1件

## Warning（推奨修正）
1. descriptionが英語で記述されている → 英語のままでも動作するが、チーム内統一のため日本語化を推奨
2. 出力テンプレートに具体的なデータ例がない → Worked Exampleの追加を推奨

## Info（改善提案）
1. maxTurnsの指定がない → 分析タスクの場合はmaxTurns: 15程度を推奨

## 具体的な推奨事項
- descriptionを日本語に変更: 「GitHub Issueの内容を分析し、コードベース構造との対応関係を調査する」
- 出力テンプレートの「path/to/file.ts」を実際のプロジェクト例に置き換え
```

**CRITICAL_ISSUESの出力例**:
```markdown
# エージェントレビューレポート: broken-agent

## サマリー
- 総合評価: CRITICAL_ISSUES
- Critical: 2件
- Warning: 1件
- Info: 0件

## Critical（必須修正）
1. システムプロンプト（ボディ）が空 → エージェントの動作が未定義
2. toolsに全ツール（*）が指定されている → 最小権限の原則に違反

## Warning（推奨修正）
1. modelが未指定 → デフォルトで最高性能モデルが使用される。明示的にsonnetを指定すべき

## 具体的な推奨事項
- ボディにエージェントの役割・タスク・出力形式を定義する
- toolsを目的に必要な最小限に絞る（例: 読み取り専用なら `Glob, Grep, Read`）
```
